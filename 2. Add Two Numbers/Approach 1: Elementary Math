#!/usr/bin/env crystal
# SEE: https://leetcode.com/problems/add-two-numbers/ <>
# ..............................................................................
class ListNode
  property val : Int32
  property next : ListNode?

  def initialize(val, _next = nil)
    @val = val
    @next = _next
  end
end

def make_list(digits)
  node = ListNode.new(digits[-1])
  index = -2

  while index >= -digits.size
    node = ListNode.new(digits[index], node)
    index -= 1
  end

  return node
end

def add_two_numbers(l1, l2)
  sums = [] of Int32

  l1_node = make_list(l1); l2_node = make_list(l2)

  loop do
    sums << l1_node.val + l2_node.val

    l1_node = l1_node.next; l2_node = l2_node.next

    if l1_node.nil?
      if l2_node.nil?
        break
      else
        loop do
          sums << l2_node.val

          l2_node = l2_node.next

          if l2_node.nil?
            break
          end
        end

        break
      end
    elsif l2_node.nil?
      loop do
        sums << l1_node.val
        l1_node = l1_node.next
        if l1_node.nil?
          break
        end
      end

      break
    end
  end

  result = [0]
  index = -1

  while index >= -sums.size
    sum = sums[index]

    if sum > 9
      carry!(result)
    end

    result << sum % 10
    index -= 1
  end

  result.reverse!

  if result[-1] == 0
    result = result[0..-2]
  end

  return result
end

def carry!(result, index = -1)
  sum = result[index] + 1
  if sum == 10
    carry!(result, index - 1)
    result[index] = 0
  else
    result[index] = sum
  end
end

# ..............................................................................
p! add_two_numbers([2, 4, 3], [5, 6, 4])
p! add_two_numbers([0], [0])
p! add_two_numbers([9, 9, 9, 9, 9, 9, 9], [9, 9, 9, 9])
